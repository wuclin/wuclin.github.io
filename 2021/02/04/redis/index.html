<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.7.2","exturl":false,"sidebar":{"position":"hide","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="NoSQL为什么用NoSQL数据量大，变化快，MySQL类关系型数据库力不从心 目前的企业架构：（凑合看一下）">
<meta property="og:type" content="article">
<meta property="og:title" content="redis">
<meta property="og:url" content="http://yoursite.com/2021/02/04/redis/index.html">
<meta property="og:site_name" content="fufu">
<meta property="og:description" content="NoSQL为什么用NoSQL数据量大，变化快，MySQL类关系型数据库力不从心 目前的企业架构：（凑合看一下）">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205121408352.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205141702671.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205141751373.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205154914180.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205154926569.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205155102188.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205160622385.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205160851649.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205161047944.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205161457780.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205161656101.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205161846215.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205161832171.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210205171642857.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210206151551069.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208134631461.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208134907563.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208143359784.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208144113573.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208150235472.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208145843494.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208151519501.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208161328816.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/image-20210208161528523.png">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/1521269040783ad8b0b3415">
<meta property="og:image" content="http://yoursite.com/2021/02/04/redis/15212690408812aad2545bb">
<meta property="article:published_time" content="2021-02-04T15:18:35.000Z">
<meta property="article:modified_time" content="2022-03-03T14:06:06.078Z">
<meta property="article:author" content="wuwu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2021/02/04/redis/image-20210205121408352.png">

<link rel="canonical" href="http://yoursite.com/2021/02/04/redis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>redis | fufu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fufu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-fw fa-calendar"></i>Schedule</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/04/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="wuwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fufu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          redis
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-04 23:18:35" itemprop="dateCreated datePublished" datetime="2021-02-04T23:18:35+08:00">2021-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-03 22:06:06" itemprop="dateModified" datetime="2022-03-03T22:06:06+08:00">2022-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h1><h3 id="为什么用NoSQL"><a href="#为什么用NoSQL" class="headerlink" title="为什么用NoSQL"></a>为什么用NoSQL</h3><p>数据量大，变化快，MySQL类关系型数据库力不从心</p>
<p>目前的企业架构：（凑合看一下）</p>
<img src="/2021/02/04/redis/image-20210205121408352.png" class title="image-20210205121408352">

<p>用于社交网络，地理位置，用户日志，等信息爆发式增长的情况</p>
<h3 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h3><p>关系型数据库：表格，行列</p>
<p>现在数据量太大咯</p>
<p>很多数据类型不需要固定格式，因此用map&lt;String,Object&gt;十分的好。</p>
<p>优点：方便扩展，大数据高性能，数据类型多样，不需要事先设计数据库</p>
<p>与传统的比较：没有固定的查询语言，键值对存储，高可用，高可扩展，CAP定理，最终一致性</p>
<p>一般是搭配使用。</p>
<h3 id="NoSQL数据库的四大分类表格分析"><a href="#NoSQL数据库的四大分类表格分析" class="headerlink" title="NoSQL数据库的四大分类表格分析"></a>NoSQL数据库的四大分类表格分析</h3><table>
<thead>
<tr>
<th align="center"><strong>分类</strong></th>
<th align="center"><strong>Examples举例</strong></th>
<th align="center">典型应用场景</th>
<th align="center">数据模型</th>
<th align="center">优点</th>
<th align="center">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>键值（key-value）[3]</strong></td>
<td align="center">Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td>
<td align="center">内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。[3]</td>
<td align="center">Key 指向 Value 的键值对，通常用hash table来实现[3]</td>
<td align="center">查找速度快</td>
<td align="center">数据无结构化，通常只被当作字符串或者二进制数据[3]</td>
</tr>
<tr>
<td align="center"><strong>列存储数据库[3]</strong></td>
<td align="center">Cassandra, HBase, Riak</td>
<td align="center">分布式的文件系统</td>
<td align="center">以列簇式存储，将同一列数据存在一起</td>
<td align="center">查找速度快，可扩展性强，更容易进行分布式扩展</td>
<td align="center">功能相对局限</td>
</tr>
<tr>
<td align="center"><strong>文档型数据库[3]</strong></td>
<td align="center">CouchDB, MongoDb</td>
<td align="center">Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容）</td>
<td align="center">Key-Value对应的键值对，Value为结构化数据</td>
<td align="center">数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td>
<td align="center">查询性能不高，而且缺乏统一的查询语法。</td>
</tr>
<tr>
<td align="center"><strong>图形(Graph)数据库[3]</strong></td>
<td align="center">Neo4J, InfoGrid, Infinite Graph</td>
<td align="center">社交网络，推荐系统等。专注于构建关系图谱</td>
<td align="center">图结构</td>
<td align="center">利用图结构相关算法。比如最短路径寻址，N度关系查找等</td>
<td align="center">很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案。[3]</td>
</tr>
</tbody></table>
<h1 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h1><p>Redis（Remote Dictionary Server）远程字典服务</p>
<h3 id="用处"><a href="#用处" class="headerlink" title="用处"></a>用处</h3><p>数据持久化，效率高，发布订阅系统，集群，事务</p>
<h3 id="window下使用"><a href="#window下使用" class="headerlink" title="window下使用"></a>window下使用</h3><p>直接去github找，不过版本比较老了</p>
<p>打开server就打开redis了</p>
<img src="/2021/02/04/redis/image-20210205141702671.png" class title="image-20210205141702671">

<p>客户端下这样表示连接上了</p>
<img src="/2021/02/04/redis/image-20210205141751373.png" class title="image-20210205141751373">

<p><strong>一般在Linux下使用</strong></p>
<h3 id="Linux下使用"><a href="#Linux下使用" class="headerlink" title="Linux下使用"></a>Linux下使用</h3><ol>
<li>下载安装包 redis.tar.gz</li>
<li>一般把软件放在opt下</li>
</ol>
<img src="/2021/02/04/redis/image-20210205154914180.png" class title="image-20210205154914180">

<p>解压完成即可<img src="/2021/02/04/redis/image-20210205154926569.png" class title="image-20210205154926569"></p>
<ol start="3">
<li>进到目录</li>
</ol>
<img src="/2021/02/04/redis/image-20210205155102188.png" class title="image-20210205155102188">

<ol start="4">
<li>环境安装</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里要注意自 redis 6.0.0 之后，编译 redis 需要支持 C11 特性，C11 特性在 4.9 中被引入。</span></span><br><span class="line"><span class="comment">#Centos7 默认 gcc 版本为 4.8.5，所以需要升级gcc版本。</span></span><br><span class="line"><span class="comment">#不然在make的时候会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yum -y install gcc gcc-c++ make tcl</span></span><br><span class="line"><span class="comment">#yum -y install centos-release-scl</span></span><br><span class="line"><span class="comment">#yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span></span><br><span class="line"><span class="comment">#scl enable devtoolset-9 bash</span></span><br><span class="line"><span class="comment">#执行以上命令升级后 再make就不会报错了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p>默认安装路径  /usr/local/bin</p>
<img src="/2021/02/04/redis/image-20210205160622385.png" class title="image-20210205160622385">
</li>
<li><p>用备份配置文件</p>
</li>
</ol>
<img src="/2021/02/04/redis/image-20210205160851649.png" class title="image-20210205160851649">

<ol start="7">
<li><p>修改配置文件，默认后台启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br></pre></td></tr></table></figure>
<img src="/2021/02/04/redis/image-20210205161047944.png" class title="image-20210205161047944">

</li>
</ol>
<p>改成yes表示默认后台启动</p>
<ol start="8">
<li>启动redis</li>
</ol>
<img src="/2021/02/04/redis/image-20210205161457780.png" class title="image-20210205161457780">

<p>这样表示连接成功</p>
<ol start="9">
<li><p>查看进程是否开启<img src="/2021/02/04/redis/image-20210205161656101.png" class title="image-20210205161656101"></p>
</li>
<li><p>怎么退出<img src="/2021/02/04/redis/image-20210205161846215.png" alt="image-20210205161846215" style="zoom:50%;"><img src="/2021/02/04/redis/image-20210205161832171.png" class title="image-20210205161832171"></p>
</li>
</ol>
<h5 id="启动："><a href="#启动：" class="headerlink" title="启动："></a>启动：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin                     <span class="comment">#要先到这个目录下</span></span><br><span class="line">redis-server wuwuconfig/redis.conf    <span class="comment">#正常需要这样启动服务，不过因为设置了默认开启这一步可以不用</span></span><br><span class="line">redis-cli                              <span class="comment">#启动客户端</span></span><br><span class="line">ping                                  <span class="comment">#测试是否启动</span></span><br></pre></td></tr></table></figure>
<h3 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000</span><br></pre></td></tr></table></figure>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><p>默认有16个数据库。</p>
<img src="/2021/02/04/redis/image-20210205171642857.png" class title="image-20210205171642857">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select index <span class="comment">#切换数据库 0~15</span></span><br><span class="line">DBSIZE <span class="comment">#查看大小，只针对当前数据库</span></span><br><span class="line">keys * <span class="comment">#查看所有key</span></span><br><span class="line">flushdb <span class="comment">#清除当前数据库</span></span><br><span class="line">flushall <span class="comment">#清空全部数据库</span></span><br></pre></td></tr></table></figure>
<h4 id="Redis是单线程的"><a href="#Redis是单线程的" class="headerlink" title="Redis是单线程的"></a>Redis是单线程的</h4><p>Redis是基于内存操作的，cpu不是性能瓶颈，瓶颈是机器的内存和网络带宽</p>
<p>因为直接和内存交互，所以比多线程块，多线程需要进行上下文切换</p>
<h1 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">keys * <span class="comment">#查看所有key</span></span><br><span class="line"><span class="built_in">set</span> key value <span class="comment"># 存值</span></span><br><span class="line">EXISTS key <span class="comment">#查看当前key是否在    </span></span><br><span class="line">move key db <span class="comment">#从db数据库中移除key</span></span><br><span class="line">EXPIRE key time <span class="comment">#在time时间内移除key， 可用于单点登录</span></span><br><span class="line">ttl key <span class="comment">#可以查看剩余移除时间</span></span><br><span class="line"><span class="built_in">type</span> key <span class="comment">#查看当前key的类型</span></span><br></pre></td></tr></table></figure>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">incr key  <span class="comment">#可以使key的值加1</span></span><br><span class="line">decr key  <span class="comment">#使key的值减1</span></span><br><span class="line">incrby key num <span class="comment">#使key的值增加num</span></span><br><span class="line">decrby key num <span class="comment">#使key的值减少num</span></span><br><span class="line"><span class="comment">#################################</span></span><br><span class="line"><span class="comment">#字符串范围 range</span></span><br><span class="line">GETRANGE key num1 num2 <span class="comment">#得到num1到num2的字符串，0，-1表示全部</span></span><br><span class="line">SETRANGE key num1 word <span class="comment">#设置num1开始的值为word</span></span><br><span class="line"><span class="comment">#################################</span></span><br><span class="line">setex key time word <span class="comment">#设置key的值为word，且在time时间后清除</span></span><br><span class="line">setnx key word      <span class="comment">#设置key的值为word，如果存在不存在才设置，存在则不操作，用于分布式锁方便</span></span><br><span class="line"><span class="comment">#################################</span></span><br><span class="line">mset key1 value1 key2 value2 <span class="comment">#批量设置</span></span><br><span class="line">mget key1 key2               <span class="comment">#批量取址</span></span><br><span class="line"><span class="comment">#注意,可以使用msetex或msetnx   #原子性操作，要么都成功要么都失败</span></span><br><span class="line"><span class="comment">#################################</span></span><br><span class="line">getset key value            <span class="comment">#先get后set，返回旧值，设置新值</span></span><br></pre></td></tr></table></figure>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LPUSH key value  <span class="comment">#可以对同一个key，push多个值，L表示从左边进</span></span><br><span class="line">LPOP key         <span class="comment">#移除第一个元素</span></span><br><span class="line">RPOP key         <span class="comment">#移除最后一个元素</span></span><br><span class="line">Llen key         <span class="comment">#返回列标长度</span></span><br><span class="line">LREM key num value <span class="comment">#移除num个value在list中</span></span><br><span class="line">LTRIM key num1 num2 <span class="comment"># 截取出指定位置的值</span></span><br><span class="line">rpoplpush key1 key2 <span class="comment">#移除列表的最后一个元素，添加到新表上</span></span><br><span class="line">lset key num value  <span class="comment">#更新key中num位置的值</span></span><br></pre></td></tr></table></figure>
<p>实际上是列表</p>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sadd key value <span class="comment">#存值</span></span><br><span class="line">smembers key   <span class="comment">#展示全部set的值</span></span><br><span class="line">sismember key value <span class="comment">#value是否在key中</span></span><br><span class="line">scard key      <span class="comment">#获取set中元素个数</span></span><br><span class="line">srem key value <span class="comment">#移除set中指定元素</span></span><br><span class="line">srandmember key <span class="comment">#随机从set中取出一个元素</span></span><br><span class="line">srandmember key num <span class="comment">#随机从set中取出num个元素</span></span><br><span class="line">spop key        <span class="comment">#随机移除元素</span></span><br><span class="line">smove <span class="comment">#移动元素到别的集合</span></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line">SDIFF key1 key2   <span class="comment">#差集</span></span><br><span class="line">SINTER key1 key2  <span class="comment">#交集</span></span><br><span class="line">SUNION key1 key2  <span class="comment">#并集</span></span><br></pre></td></tr></table></figure>
<h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><p>相当于value为map</p>
<p>hash适合用于对象，String适合用于字符串</p>
<h4 id="Zset（有序集合）"><a href="#Zset（有序集合）" class="headerlink" title="Zset（有序集合）"></a>Zset（有序集合）</h4><p>在set的基础上，加上了排序，添加时可以按照给定的顺序添加</p>
<h1 id="特殊数据类型"><a href="#特殊数据类型" class="headerlink" title="特殊数据类型"></a>特殊数据类型</h1><h4 id="geospatial-地理位置"><a href="#geospatial-地理位置" class="headerlink" title="geospatial 地理位置"></a>geospatial 地理位置</h4><p>使用的是zset，看文档就好了，主要是将一些地理位置存进去，然后可以计算距离</p>
<h4 id="hyperloglog-基数统计"><a href="#hyperloglog-基数统计" class="headerlink" title="hyperloglog 基数统计"></a>hyperloglog 基数统计</h4><p>基数统计：集合中不重复数的数量</p>
<p>可以用作统计访问量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PFadd key value1 value2 value3 <span class="comment">#把value1，2，3放入key中</span></span><br><span class="line">PFcount key                    <span class="comment">#返回key中value的个数</span></span><br><span class="line">PFadd key2 value2 value4       </span><br><span class="line">PFMERGE key3 key1 key2         <span class="comment">#把key1，key2合并到key3中，数据不重复</span></span><br></pre></td></tr></table></figure>
<p>还是有点误差的</p>
<h4 id="bitmaps"><a href="#bitmaps" class="headerlink" title="bitmaps"></a>bitmaps</h4><p>位图，操作二进制位进行记录只有0，1两个状态</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>redis单条命令保证原子性，事务不保证原子性，没有隔离级别概念（就是不会有脏读，幻读，不可重复读）</p>
<p>只有在事务执行时，事务内的指令才会执行</p>
<h4 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h4><blockquote>
<p>开启事务（multi）</p>
<p>命令</p>
<p>执行事务（exec）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi            <span class="comment">#开启事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key1 value1  <span class="comment">#命令</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>             <span class="comment">#执行事务</span></span><br><span class="line">1) OK</span><br><span class="line">2) <span class="string">&quot;value1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DISCARD                          <span class="comment">#取消事务，事务内的命令都不会被执行</span></span><br></pre></td></tr></table></figure>

<p>注意：每一次使用事务都需要multi</p>
</blockquote>
<h4 id="异常："><a href="#异常：" class="headerlink" title="异常："></a>异常：</h4><p>编译型异常：代码出问题，事务中的命令都不会被执行</p>
<p>运行时异常：事务中出问题的命令不会被执行，其他的会执行</p>
<h4 id="监控："><a href="#监控：" class="headerlink" title="监控："></a>监控：</h4><p>悲观锁：无论做什么都会加锁</p>
<p>乐观锁：只有在更新时，检查到数据被修改过才会加锁</p>
<p>正常情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money       <span class="comment">#监视money</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<p>多个线程情况下：乐观锁实例（watch）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一个线程 watch money</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二个线程 修改money</span></span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line"><span class="string">&quot;80&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 1000</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一个线程 提交事务</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>         <span class="comment">#提交事务，返回nil，因为money被修改了再提交事务之前</span></span><br><span class="line">(nil)</span><br><span class="line"></span><br><span class="line">UNWATCH                         <span class="comment">#解除监视，事务失败后可以先解除</span></span><br><span class="line">WATCH money                     <span class="comment">#再重新监视</span></span><br></pre></td></tr></table></figure>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><p>使用Java操作Redis。</p>
<p>Jedis是java连接开发工具，即Java操作Redis的中间件</p>
<ol>
<li><p>加入依赖</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>测试连接是否成功（注意jedis就是redis，与redis的所有指令都是一样的）</p>
</li>
</ol>
<img src="/2021/02/04/redis/image-20210206151551069.png" class title="image-20210206151551069">

<p>127.0.0.1表示本地的，也可以换成远程的</p>
<p>附加：java操作事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6479</span>);</span><br><span class="line">    ...</span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    multi.set();</span><br><span class="line">    multi.set();</span><br><span class="line">    ...</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exection e)&#123;</span><br><span class="line">    multi.discard();</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span>()&#123;</span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="SpringBoot整合redis"><a href="#SpringBoot整合redis" class="headerlink" title="SpringBoot整合redis"></a>SpringBoot整合redis</h1><p>springBoot：放在spring-data下</p>
<p>在springBoot2.x之后，jedis被替换位lettuce</p>
<p>jedis： 采用直连，多个线程操作的话，是不安全的，可以使用jedispool连接池解决（BIO）</p>
<p>lettuce：采用netty，实例可以在多个线程中共享，不存在线程不安全的的情况.（NIO）</p>
<h1 id="Redis-conf"><a href="#Redis-conf" class="headerlink" title="Redis.conf"></a>Redis.conf</h1><p>大小写不敏感</p>
<blockquote>
<p>网络</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1      <span class="comment">#绑定的ip</span></span><br><span class="line">protected-mode yes  <span class="comment">#保护模式</span></span><br><span class="line">port 6379           <span class="comment">#端口</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通用</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes       <span class="comment">#后台，默认为no，以守护进程方式运行</span></span><br><span class="line">pidfile /var/run/redis_6379.pid <span class="comment">#如果以后台运行就需要指定pid文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#日志部分</span></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably)</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the log file name. Also the empty string can be used to force</span></span><br><span class="line"><span class="comment"># Redis to log on the standard output. Note that if you use standard</span></span><br><span class="line"><span class="comment"># output for logging but daemonize, logs will be sent to /dev/null</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span>   <span class="comment">#这里填日志的文件位置</span></span><br><span class="line"><span class="comment">#结束</span></span><br><span class="line"></span><br><span class="line">databases 16   <span class="comment">#默认数据库数量</span></span><br><span class="line">always-show-logo yes  <span class="comment">#是否显示logo，就是开启服务时的那个logo</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>快照</p>
</blockquote>
<p>即在规定时间内执行了多少次操作，则会持久化到文件（.rdb   .aof）</p>
<p>因为redis是内存数据库，没有持久化，断电就会失去数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">save 900 1     <span class="comment">#900s内，至少有1个key进行了修改，就会持久化</span></span><br><span class="line">save 300 10       <span class="comment">#300s内，至少有10个key进行了修改，就会持久化</span></span><br><span class="line">save 60 10000  <span class="comment">#60s内，至少有10000个key进行了修改，就会持久化</span></span><br><span class="line"><span class="comment">#可以自定义</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes  <span class="comment">#持久化失败之后是否继续工作</span></span><br><span class="line">rdbcompression yes               <span class="comment">#是否压缩rdb文件，需消耗cpu资源</span></span><br><span class="line">rdbchecksum yes                     <span class="comment">#保存rdb时，是否进行错误的检查            </span></span><br><span class="line">dir ./                             <span class="comment">#rdb保存目录，默认为当前</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>REPLICATION （主从复制）</p>
</blockquote>
<blockquote>
<p>SECURITY  (安全)</p>
</blockquote>
<img src="/2021/02/04/redis/image-20210208134631461.png" alt="image-20210208134631461" style="zoom: 67%;">

<p>默认不需要密码，可以通过配置文件，或命令行设置密码</p>
<img src="/2021/02/04/redis/image-20210208134907563.png" class title="image-20210208134907563">

<p>这时如果没有auth密码就没有权限</p>
<img src="/2021/02/04/redis/image-20210208143359784.png" class title="image-20210208143359784">

<blockquote>
<p>限制 （CLIENTS）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000   <span class="comment">#能连接上redis最大客户端数量</span></span><br><span class="line">maxmemory &lt;bytes&gt;  <span class="comment">#redis 配置最大内存容量</span></span><br><span class="line">maxmemory-policy noeviction <span class="comment">#内存达到上限默认处理策略</span></span><br><span class="line">    noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。</span><br><span class="line">    allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key。</span><br><span class="line">    allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。</span><br><span class="line">    volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。</span><br><span class="line">    volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。</span><br><span class="line">    volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>APPEND ONLY MODE  (aof配置)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly no    <span class="comment">#默认不开启，默认使用rdb方式持久化，大部分情况下rdb足够使用</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span> <span class="comment">#持久化文件的名字</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always    #每次修改都同步，消耗性能</span></span><br><span class="line">appendfsync everysec    <span class="comment">#每秒执行一次同步，可能会丢失这1s的数据</span></span><br><span class="line"><span class="comment"># appendfsync no        #不执行同步，操作系统自己同步，速度最快</span></span><br></pre></td></tr></table></figure>
<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><p>内存型数据库都需要进行持久化，否则服务器退出，数据也会消失</p>
<h2 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB (Redis DataBase)"></a>RDB (Redis DataBase)</h2><p>在主从复制中，rdb就是备用</p>
<img src="/2021/02/04/redis/image-20210208144113573.png" class title="image-20210208144113573">

<p>在指定的时间间隔内将内存中的数据快照写入磁盘，恢复时将快照文件直接读到内存中。缺点是最后一次持久化后的数据可能丢失。</p>
<p>Redis会单独创建一个子进程进行持久化，会先将数据写到一个临时文件，等该次持久化过程结束后，再用这个文件替换上次持久化好的文件。整个过程中，主进程不进行IO操作，确保高性能。</p>
<p>rbd保存在dump.rdb文件中，有时候会对这个文件进行备份</p>
<blockquote>
<p>生成rdb文件</p>
</blockquote>
<ol>
<li>save规则满足的情况下</li>
<li>执行flushall命令</li>
<li>退出redis</li>
</ol>
<p>备份就会自动生成dump.rdb</p>
<blockquote>
<p>如何恢复rdb文件数据</p>
</blockquote>
<ol>
<li>将rdb文件放在redis启动目录，redis启动的时候就会自动检查dump.rdb恢复其中的数据</li>
<li>查看需要存在的位置</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) <span class="string">&quot;dir&quot;</span></span><br><span class="line">2) <span class="string">&quot;/usr/local/bin&quot;</span>    <span class="comment">#如果这个目录下存在dump.rdb文件，redis启动就会自动恢复其中的数据</span></span><br></pre></td></tr></table></figure>
<h2 id="AOF-（Append-Only-File）"><a href="#AOF-（Append-Only-File）" class="headerlink" title="AOF （Append Only File）"></a>AOF （Append Only File）</h2><img src="/2021/02/04/redis/image-20210208150235472.png" class title="image-20210208150235472">

<p><strong>以日志的形式记录每一个写操作，只允许追加文件，但不改写文件。redis一启动就会读取该文件重新构建数据。</strong></p>
<p>Aof保存的是 appendonly.aof</p>
<p>默认是不开启的，可以在配置文件中开启</p>
<p>如果aof文件出现了问题，可能导致无法开启redis，需要进行修复，redis提供一个工具可以去修复</p>
<img src="/2021/02/04/redis/image-20210208145843494.png" class title="image-20210208145843494">

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix   <span class="comment">#表示对aof文件进行修复</span></span><br></pre></td></tr></table></figure>
<p>缺点：</p>
<ol>
<li>aof文件比rdb文件大，修复的速度也慢</li>
<li>aof运行效率比rdb慢，所以redis默认为rdb</li>
</ol>
<p>在主机和从机中，比较文件大的rdb来载入。</p>
<h1 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h1><p>信息通信模式，发送者发送信息，订阅者接受信息</p>
<p>Redis客户端可以订阅任意数量的频道</p>
<img src="/2021/02/04/redis/image-20210208151519501.png" class title="image-20210208151519501">

<blockquote>
<p>命令</p>
<p>构建即时通信应用</p>
</blockquote>
<p>发布者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bubububu bin]<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; publish wuwu nihao     <span class="comment">#在wuwu频道发布 nihao</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; publish wuwu amazing    </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p>订阅者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe wuwu              <span class="comment">#订阅wuwu频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;wuwu&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1                    <span class="comment">#这下面是发布者发送信息后自动获取的</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span>                    <span class="comment">#消息        </span></span><br><span class="line">2) <span class="string">&quot;wuwu&quot;</span>                        <span class="comment">#频道</span></span><br><span class="line">3) <span class="string">&quot;nihao&quot;</span>                        <span class="comment">#具体消息</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;wuwu&quot;</span></span><br><span class="line">3) <span class="string">&quot;amazing&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h1><p>主从复制：是指将一台redis服务器的数据复制到其他的redis服务器。数据的复制时单向的，只能由主节点到从结点。Master以写为为主，Slave以读为主。</p>
<h4 id="主从复制主要作用"><a href="#主从复制主要作用" class="headerlink" title="主从复制主要作用"></a>主从复制主要作用</h4><ol>
<li>数据冗余：实现了数据的热备份</li>
<li>故障恢复：主节点出现问题，可以由从结点提供服务</li>
<li>负载均衡：配合读写分离，主负责写，从负责读，分担服务器负载</li>
<li>高可用：实施哨兵模式和集群的基础</li>
</ol>
<p>一般来说，一台Redis是不行的，宕机可能，至少三个，一主二从，如果redis内存超过20g，最好改用集群模式</p>
<h4 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h4><p><strong>只配置从库，不用配置主库。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@bubububu bin]<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; info replication    <span class="comment">#用于查看当前库的信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master              <span class="comment">#角色 master</span></span><br><span class="line">connected_slaves:0         <span class="comment">#没有从机</span></span><br><span class="line">master_replid:e4e8e6281a6285ffc08ee2935ea10d45fe79d38a</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>
<p>模拟步骤：</p>
<ol>
<li><p>使用xshell打开三个窗口</p>
</li>
<li><p>```bash<br>[root@bubububu wuwuconfig]# cp redis.conf redis79.conf<br>[root@bubububu wuwuconfig]# cp redis.conf redis80conf<br>[root@bubububu wuwuconfig]# cp redis.conf redis81.conf<br>[root@bubububu wuwuconfig]# cp redis.conf redis80.conf<br>[root@bubububu wuwuconfig]# ls<br>redis79.conf  redis80conf  redis80.conf  redis81.conf  redis.conf<br>[root@bubububu wuwuconfig]# rm redis80conf<br>rm: remove regular file ‘redis80conf’? y<br>[root@bubububu wuwuconfig]# ls<br>redis79.conf  redis80.conf  redis81.conf  redis.conf<br>#创建多个配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. &#96;&#96;&#96;bash</span><br><span class="line">   vim redisxx.config #进入配置文件中修改信息</span><br><span class="line">   </span><br><span class="line">   #一般需要修改信息</span><br><span class="line">   port 6380    #端口号</span><br><span class="line">   pidfile &#x2F;var&#x2F;run&#x2F;redis_6380.pid  #pid</span><br><span class="line">   logfile &quot;6380.log&quot;               #日志</span><br><span class="line">   dbfilename dump6380.rdb             #dump文件</span><br></pre></td></tr></table></figure></li>
<li><p>分别启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server wuwuconfig/redis79.conf</span><br><span class="line">redis-server wuwuconfig/redis80.conf</span><br><span class="line">redis-server wuwuconfig/redis81.conf</span><br></pre></td></tr></table></figure>

<p>有log文件表示已经启动<img src="/2021/02/04/redis/image-20210208161328816.png" class title="image-20210208161328816"></p>
<p>或者查看进程</p>
<img src="/2021/02/04/redis/image-20210208161528523.png" class title="image-20210208161528523">

</li>
</ol>
<h4 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h4><p>默认情况下，每台redis服务器都是主节点，一般情况下只配置从机。下面默认79为主，80，81为从</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6381   <span class="comment">#启动不同端口的redis</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 6379    <span class="comment">#80端口的认79端口为主机</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication          <span class="comment">#查看信息，角色已经改变</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:0</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:c05c6886717085accf2308e57fb2a0351c8bdadd</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br></pre></td></tr></table></figure>
<p>上面使用命令的配置是暂时的，在配置文件中才是永久的 </p>
<h4 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h4><ol>
<li><p>只有主机才可以写</p>
</li>
<li><p>主机中的信息和数据都会自动被从机保存</p>
</li>
<li><p>主机断开连接，从机依旧连接到主机</p>
</li>
<li><p>复制原理</p>
<blockquote>
<p>Slave启动成功后连接到Master后会发送一个sync命令</p>
<p>Master接到命令之后，启动后台进程，后台进程执行完毕之后，master将传送整个数据文件到Slave，完成一次同步</p>
<p>全量复制：slave收到数据库文件数据后，存盘并加载到内存</p>
<p>增量复制：Master继续将新的修改命令依次传给slave，完成同步</p>
<p>只要连接到主机就一定会执行全量复制</p>
</blockquote>
</li>
</ol>
<h4 id="主机宕机后手动配置主机"><a href="#主机宕机后手动配置主机" class="headerlink" title="主机宕机后手动配置主机"></a>主机宕机后手动配置主机</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one   <span class="comment">#使当前服务器变成主机</span></span><br></pre></td></tr></table></figure>
<h4 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h4><p>2.8开始提供Sentinel解决手动配置主机问题，能够后台监控主机是否故障，如果故障了根据投票数自动把从库转换成主库</p>
<p>哨兵是一个独立的进程，原理是哨兵通过发送命令，等待redis服务器响应，从而监控多个redis</p>
<p>一般会给哨兵添加哨兵</p>
<p>实例：</p>
<ol>
<li>配置哨兵配置文件sentinel.conf</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor myredis 127.0.0.1 6379 1  <span class="comment">#后面的1代表主机挂了，slave投票看让谁替代</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>启动哨兵</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@bubububu bin]<span class="comment"># redis-sentinel wuwuconfig/sentinel.conf  #启动</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.349 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.349 <span class="comment"># Redis version=6.0.10, bits=64, commit=00000000, modified=0, pid=31633, just started</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.349 <span class="comment"># Configuration loaded</span></span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._                                             </span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 6.0.10 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._                                   </span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 31633</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io        </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|                                  </span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |                                  </span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span>                                   </span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>                                       </span><br><span class="line">          `-._        _.-<span class="string">&#x27;                                           </span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span>                                               </span><br><span class="line"></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.350 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.360 <span class="comment"># Sentinel ID is b0633fe56cc7d558d895f49b2b10acfd9b7e842e</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.360 <span class="comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></span><br><span class="line">31633:X 08 Feb 2021 17:57:31.361 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br></pre></td></tr></table></figure>
<p>如果Master断开后，就会从从机中随机选择服务器当作主机</p>
<blockquote>
<p>如果主机回来了，也只能到新主机下作为从机</p>
</blockquote>
<p>缺点：</p>
<ol>
<li>redis不好在线扩容</li>
<li>哨兵模式配置麻烦</li>
</ol>
<h1 id="Redis缓存穿透和雪崩"><a href="#Redis缓存穿透和雪崩" class="headerlink" title="Redis缓存穿透和雪崩"></a>Redis缓存穿透和雪崩</h1><h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><p>由于原有缓存失效，新缓存未到期间(例如：我们设置缓存时采用了相同的过期时间，在同一时刻出现大面积的缓存过期)，所有原本应该访问缓存的请求都去查询数据库了，而对数据库CPU和内存造成巨大压力，严重的会造成数据库宕机。从而形成一系列连锁反应，造成整个系统崩溃。</p>
<p>缓存正常从Redis中获取，示意图如下：</p>
<img src="/2021/02/04/redis/1521269040783ad8b0b3415" class title="阿里P8技术专家细究分布式缓存问题">

<p>缓存失效瞬间示意图如下：</p>
<img src="/2021/02/04/redis/15212690408812aad2545bb" class title="阿里P8技术专家细究分布式缓存问题">

<p>解决方案：可以把过期时间设置为随机</p>
<h2 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h2><p>缓存穿透是指用户查询数据，在数据库没有，自然在缓存中也不会有。这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空（相当于进行了两次无用的查询）。这样请求就绕过缓存直接查数据库，这也是经常提的缓存命中率问题。</p>
<p> 缓存穿透解决方案：</p>
<p>（1）采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。</p>
<p>（2）如果一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。通过这个直接设置的默认值存放到缓存，这样第二次到缓存中获取就有值了，而不会继续访问数据库，这种办法最简单粗暴！</p>
<p>把空结果也给缓存起来，这样下次同样的请求就可以直接返回空了，即可以避免当查询的值为空时引起的缓存穿透。同时也可以单独设置个缓存区域存储空值，对要查询的key进行预先校验，然后再放行给后面的正常缓存处理逻辑。</p>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><p>key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题。</p>
<h1 id="缓存常用的读写策略"><a href="#缓存常用的读写策略" class="headerlink" title="缓存常用的读写策略"></a>缓存常用的读写策略</h1><h4 id="Cache-Aside-Pattern（旁路缓存模式）"><a href="#Cache-Aside-Pattern（旁路缓存模式）" class="headerlink" title="Cache Aside Pattern（旁路缓存模式）"></a><strong>Cache Aside Pattern</strong>（旁路缓存模式）</h4><p><strong>Cache Aside Pattern 是我们平时使用比较多的一个缓存读写模式，比较适合读请求比较多的场景。</strong></p>
<p>Cache Aside Pattern 中服务端需要同时维系 DB 和 cache，并且是以 DB 的结果为准。</p>
<p><strong>写</strong> ：</p>
<ul>
<li>先更新 DB</li>
<li>然后直接删除 cache 。</li>
</ul>
<p><strong>读</strong> :</p>
<ul>
<li>从 cache 中读取数据，读取到就直接返回</li>
<li>cache中读取不到的话，就从 DB 中读取数据返回</li>
<li>再把数据放到 cache 中。</li>
</ul>
<p>问题：<strong>在写数据的过程中，可以先删除 cache ，后更新 DB 么</strong></p>
<p>这样可能会造成<strong>数据库（DB）和缓存（Cache）数据不一致</strong>的问题。缓存的写入速度是比数据库的写入速度快很多！</p>
<h4 id="Read-Write-Through-Pattern（读写穿透）"><a href="#Read-Write-Through-Pattern（读写穿透）" class="headerlink" title="Read/Write Through Pattern（读写穿透）"></a>Read/Write Through Pattern（读写穿透）</h4><p>Read/Write Through Pattern 中服务端把 cache 视为主要数据存储，从中读取数据并将数据写入其中。cache 服务负责将此数据读取和写入 DB，从而减轻了应用程序的职责。</p>
<p>这种缓存读写策略小伙伴们应该也发现了在平时在开发过程中非常少见。抛去性能方面的影响，大概率是因为我们经常使用的分布式缓存 Redis 并没有提供 cache 将数据写入DB的功能。</p>
<p><strong>写（Write Through）：</strong></p>
<ul>
<li>先查 cache，cache 中不存在，直接更新 DB。</li>
<li>cache 中存在，则先更新 cache，然后 cache 服务自己更新 DB（<strong>同步更新 cache 和 DB</strong>）。</li>
</ul>
<p><strong>读(Read Through)：</strong></p>
<ul>
<li>从 cache 中读取数据，读取到就直接返回 。</li>
<li>读取不到的话，先从 DB 加载，写入到 cache 后返回响应。</li>
</ul>
<p>Read-Through Pattern 实际只是在 Cache-Aside Pattern 之上进行了封装。在 Cache-Aside Pattern 下，发生读请求的时候，如果 cache 中不存在对应的数据，是由客户端自己负责把数据写入 cache，而 Read Through Pattern 则是 cache 服务自己来写入缓存的，这对客户端是透明的。</p>
<p>和 Cache Aside Pattern 一样， Read-Through Pattern 也有首次请求数据一定不再 cache 的问题，对于热点数据可以提前放入缓存中。</p>
<h4 id="Write-Behind-Pattern-（异步缓存写入）"><a href="#Write-Behind-Pattern-（异步缓存写入）" class="headerlink" title="Write Behind Pattern （异步缓存写入）"></a>Write Behind Pattern （异步缓存写入）</h4><p>Write Behind Pattern 和 Read/Write Through Pattern 很相似，两者都是由 cache 服务来负责 cache 和 DB 的读写。</p>
<p>但是，两个又有很大的不同：<strong>Read/Write Through 是同步更新 cache 和 DB，而 Write Behind Caching 则是只更新缓存，不直接更新 DB，而是改为异步批量的方式来更新 DB。</strong></p>
<p>很明显，这种方式对数据一致性带来了更大的挑战，比如cache数据可能还没异步更新DB的话，cache服务可能就就挂掉了。</p>
<p>这种策略在我们平时开发过程中也非常非常少见，但是不代表它的应用场景少，比如消息队列中消息的异步写入磁盘、MySQL 的 InnoDB Buffer Pool 机制都用到了这种策略。</p>
<p>Write Behind Pattern 下 DB 的写性能非常高，非常适合一些数据经常变化又对数据一致性要求没那么高的场景，比如浏览量、点赞量。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/01/JVM/" rel="prev" title="JVM">
      <i class="fa fa-chevron-left"></i> JVM
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/06/leetcode/" rel="next" title="leetcode">
      leetcode <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL"><span class="nav-number">1.</span> <span class="nav-text">NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8NoSQL"><span class="nav-number">1.0.1.</span> <span class="nav-text">为什么用NoSQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFNoSQL"><span class="nav-number">1.0.2.</span> <span class="nav-text">什么是NoSQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB%E8%A1%A8%E6%A0%BC%E5%88%86%E6%9E%90"><span class="nav-number">1.0.3.</span> <span class="nav-text">NoSQL数据库的四大分类表格分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E5%85%A5%E9%97%A8"><span class="nav-number">2.</span> <span class="nav-text">Redis入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E5%A4%84"><span class="nav-number">2.0.1.</span> <span class="nav-text">用处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#window%E4%B8%8B%E4%BD%BF%E7%94%A8"><span class="nav-number">2.0.2.</span> <span class="nav-text">window下使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E4%B8%8B%E4%BD%BF%E7%94%A8"><span class="nav-number">2.0.3.</span> <span class="nav-text">Linux下使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%EF%BC%9A"><span class="nav-number">2.0.3.0.1.</span> <span class="nav-text">启动：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%80%A7%E8%83%BD"><span class="nav-number">2.0.4.</span> <span class="nav-text">测试性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">2.0.5.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84"><span class="nav-number">2.0.5.1.</span> <span class="nav-text">Redis是单线程的</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.</span> <span class="nav-text">基本数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String"><span class="nav-number">3.0.0.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">3.0.0.2.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Set"><span class="nav-number">3.0.0.3.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hash"><span class="nav-number">3.0.0.4.</span> <span class="nav-text">Hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Zset%EF%BC%88%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">3.0.0.5.</span> <span class="nav-text">Zset（有序集合）</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.</span> <span class="nav-text">特殊数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#geospatial-%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.0.0.1.</span> <span class="nav-text">geospatial 地理位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hyperloglog-%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1"><span class="nav-number">4.0.0.2.</span> <span class="nav-text">hyperloglog 基数统计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bitmaps"><span class="nav-number">4.0.0.3.</span> <span class="nav-text">bitmaps</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">5.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="nav-number">5.0.0.1.</span> <span class="nav-text">使用方法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%EF%BC%9A"><span class="nav-number">5.0.0.2.</span> <span class="nav-text">异常：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%EF%BC%9A"><span class="nav-number">5.0.0.3.</span> <span class="nav-text">监控：</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jedis"><span class="nav-number">6.</span> <span class="nav-text">Jedis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot%E6%95%B4%E5%90%88redis"><span class="nav-number">7.</span> <span class="nav-text">SpringBoot整合redis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-conf"><span class="nav-number">8.</span> <span class="nav-text">Redis.conf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">9.</span> <span class="nav-text">Redis持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB-Redis-DataBase"><span class="nav-number">9.1.</span> <span class="nav-text">RDB (Redis DataBase)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF-%EF%BC%88Append-Only-File%EF%BC%89"><span class="nav-number">9.2.</span> <span class="nav-text">AOF （Append Only File）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="nav-number">10.</span> <span class="nav-text">Redis发布订阅</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">11.</span> <span class="nav-text">Redis主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8"><span class="nav-number">11.0.0.1.</span> <span class="nav-text">主从复制主要作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">11.0.0.2.</span> <span class="nav-text">环境配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E"><span class="nav-number">11.0.0.3.</span> <span class="nav-text">一主二从</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%86%E8%8A%82"><span class="nav-number">11.0.0.4.</span> <span class="nav-text">细节</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BA%E5%AE%95%E6%9C%BA%E5%90%8E%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA"><span class="nav-number">11.0.0.5.</span> <span class="nav-text">主机宕机后手动配置主机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="nav-number">11.0.0.6.</span> <span class="nav-text">哨兵模式</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9"><span class="nav-number">12.</span> <span class="nav-text">Redis缓存穿透和雪崩</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-number">12.1.</span> <span class="nav-text">缓存雪崩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="nav-number">12.2.</span> <span class="nav-text">缓存穿透</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="nav-number">12.3.</span> <span class="nav-text">缓存击穿</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AF%BB%E5%86%99%E7%AD%96%E7%95%A5"><span class="nav-number">13.</span> <span class="nav-text">缓存常用的读写策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cache-Aside-Pattern%EF%BC%88%E6%97%81%E8%B7%AF%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="nav-number">13.0.0.1.</span> <span class="nav-text">Cache Aside Pattern（旁路缓存模式）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Read-Write-Through-Pattern%EF%BC%88%E8%AF%BB%E5%86%99%E7%A9%BF%E9%80%8F%EF%BC%89"><span class="nav-number">13.0.0.2.</span> <span class="nav-text">Read&#x2F;Write Through Pattern（读写穿透）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Write-Behind-Pattern-%EF%BC%88%E5%BC%82%E6%AD%A5%E7%BC%93%E5%AD%98%E5%86%99%E5%85%A5%EF%BC%89"><span class="nav-number">13.0.0.3.</span> <span class="nav-text">Write Behind Pattern （异步缓存写入）</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wuwu"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">wuwu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuwu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v5.3.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
